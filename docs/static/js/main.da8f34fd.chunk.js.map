{"version":3,"sources":["hooks/useSimulation/simulation.worker.js","hooks/useInterval/index.js","hooks/useSimulation/constants.js","hooks/useSimulation/renderUtils.js","hooks/useSimulation/index.js","components/Canvas/Canvas2d.js","hooks/useCanvas/index.js","components/VirusStackedArea/VirusStackedArea.jsx","components/MultiSimulationContainer/MultiSimulationContainer.jsx","components/MaskSimulation/MaskSimulation.jsx","components/MaskSimulation/MaskSimulationContainer.jsx","App.js","serviceWorker.js","index.js"],"names":["addMethods","methods","module","exports","w","Worker","name","useInterval","callback","delay","savedCallback","useRef","useEffect","current","id","setInterval","clearInterval","DISEASE","MASK","MASK_ATTACK_REDUCTION","COLOR_BY_DISEASE","STROKE_WIDTH_BY_MASK","STROKE_COLOR_BY_MASK","defaultFillFunction","disease_status","defaultStrokeFunction","mask_status","defaultStrokeWidthFunction","drawNode","ctx","node","fill","stroke","strokeWidth","beginPath","arc","x","y","radius","Math","PI","save","strokeStyle","lineWidth","restore","fillStyle","noop","Canvas2d","onClick","className","drawFunction","height","width","canvasPixelRatio","onMouseDown","onMouseMove","onMouseUp","style","onTouchEnd","onTouchMove","onTouchStart","canvasRef","draw","ratio","canvas","getContext","animationFrameId","requestAnimationFrame","clearRect","scale","cancelAnimationFrame","useCanvas","sizeInPixels","ref","INFECTED","SUSCEPTIBLE","RECOVERED","VirusStackedArea","handleMouseMove","handleTouchMove","handleMouseLeave","containerHeight","margin","top","left","bottom","right","transitionDuration","fullHistory","virusHistory","nNodes","containerWidth","useMemo","interval","String","length","subsampled","i","push","xScale","maxTick","max","tick","scaleLinear","domain","range","yScale","series","stack","keys","areasRef","useLayoutEffect","areaGen","area","d","data","y0","y1","select","selectAll","join","attr","key","onMouseLeave","viewBox","preserveAspectRatio","overflow","transform","positionNodes","virusNodes","nodes","fillFunction","strokeFunction","strokeWidthFunction","forEach","index","drawNodes","MultiSimulationContainer","simulationState","isRunning","isStasisReached","virusSimulations","handleClick","interactionMessage","map","title","percentMasked","ontouchend","defaultProps","attackSuccessProbability","historyInterval","ticksToRecover","velocity","maskedType","nInfected","maskTransmissionReduction","Simulation","simulationProps","useState","setSimulationState","wrapDenom","min","onSimulationTicked","tickInterval","worker","setWorker","postMessage","action","sim","SimulationWorker","addEventListener","event","useSimulation","useCallback","MaskSimulationContainer","useMeasure","containerRef","App","Boolean","window","location","hostname","match","ReactDOM","render","StrictMode","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister","catch","error","console","message"],"mappings":"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","file":"static/js/main.da8f34fd.chunk.js","sourcesContent":["\n\t\t\t\tvar addMethods = require(\"../../../node_modules/workerize-loader/dist/rpc-wrapper.js\")\n\t\t\t\tvar methods = []\n\t\t\t\tmodule.exports = function() {\n\t\t\t\t\tvar w = new Worker(__webpack_public_path__ + \"e66cde783390edbe6aa2.worker.js\", { name: \"[hash].worker.js\" })\n\t\t\t\t\taddMethods(w, methods)\n\t\t\t\t\t\n\t\t\t\t\treturn w\n\t\t\t\t}\n\t\t\t","/** copied from https://overreacted.io/making-setinterval-declarative-with-react-hooks/ */\nimport { useEffect, useRef } from 'react';\n\nexport default function useInterval(callback, delay) {\n  const savedCallback = useRef();\n\n  // Remember the latest callback.\n  useEffect(() => {\n    savedCallback.current = callback;\n  }, [callback]);\n\n  // Set up the interval.\n  useEffect(() => {\n    function tick() {\n      savedCallback.current();\n    }\n    if (delay !== null) {\n      const id = setInterval(tick, delay);\n      return () => clearInterval(id);\n    }\n  }, [delay]);\n}\n","export const DISEASE = {\n  INFECTED: 0,\n  SUSCEPTIBLE: 1,\n  RECOVERED: 2,\n};\n\nexport const MASK = {\n  NO_MASK: 0,\n  NON_MEDICAL: 1,\n  MEDICAL: 2,\n};\n\nexport const MASK_ATTACK_REDUCTION = {\n  [MASK.NO_MASK]: 1, // 1 = no change in transmissivity\n  [MASK.NON_MEDICAL]: 0.67,\n  [MASK.MEDICAL]: 0.55\n};\n\nexport const COLOR_BY_DISEASE = {\n  [DISEASE.INFECTED]: \"#BB641D\",\n  [DISEASE.SUSCEPTIBLE]: \"#AAC6CA\",\n  [DISEASE.RECOVERED]: \"#CB8AC0\",\n};\n\nexport const STROKE_WIDTH_BY_MASK = {\n  [MASK.NO_MASK]: 0,\n  [MASK.NON_MEDICAL]: 3,\n  [MASK.MEDICAL]: 4\n};\n\nexport const STROKE_COLOR_BY_MASK = {\n  [MASK.NO_MASK]: '#fff',\n  [MASK.NON_MEDICAL]: '#000',\n  [MASK.MEDICAL]: '#000'\n};\n","import { COLOR_BY_DISEASE, STROKE_COLOR_BY_MASK, STROKE_WIDTH_BY_MASK } from './constants';\n\nconst defaultFillFunction = ({ disease_status }) => COLOR_BY_DISEASE[disease_status];\nconst defaultStrokeFunction = ({ mask_status }) => STROKE_COLOR_BY_MASK[mask_status];\nconst defaultStrokeWidthFunction = ({ mask_status }) =>\n  STROKE_WIDTH_BY_MASK[mask_status];\n\nexport function drawNode(ctx, node, fill, stroke, strokeWidth = 2) {\n  ctx.beginPath();\n  ctx.arc(node.x, node.y, node.radius - (strokeWidth ? strokeWidth / 2 : 0), 0, Math.PI * 2, false);\n\n  if (strokeWidth > 0) {\n    ctx.save();\n    ctx.strokeStyle = stroke || 'none';\n    ctx.lineWidth = strokeWidth;\n    ctx.stroke();\n    ctx.restore();\n  }\n\n  ctx.fillStyle = fill;\n  ctx.strokeStyle = stroke || 'none';\n  ctx.fill();\n}\n\nexport function drawNodes(\n  ctx,\n  nodes,\n  virusNodes,\n  fillFunction = defaultFillFunction,\n  strokeFunction = defaultStrokeFunction,\n  strokeWidthFunction = defaultStrokeWidthFunction,\n) {\n  nodes.forEach((node, index) =>\n    drawNode(\n      ctx,\n      node,\n      fillFunction(virusNodes[index]),\n      strokeFunction(virusNodes[index]),\n      strokeWidthFunction(virusNodes[index])\n    )\n  );\n}\n","import { useState, useEffect } from 'react';\nimport useInterval from '../useInterval';\nimport SimulationWorker from 'workerize-loader!./simulation.worker'; // eslint-disable-line import/no-webpack-loader-syntax\n\nexport * from './renderUtils';\nexport * from './constants';\n\nfunction noop() {}\n\nexport default function useSimulation(simulationProps, onSimulationTicked = noop, tickInterval = 10)  {\n  const [worker, setWorker] = useState(null);\n\n  useInterval(() => {\n    if (worker) {\n      worker.postMessage({ action: 'TICK' });\n    }\n  }, tickInterval);\n\n  useEffect(() => {\n    if (!worker) {\n      const sim = new SimulationWorker();\n      sim.postMessage({\n        action: 'NEW_SIMULATION',\n        ...simulationProps,\n      });\n      sim.addEventListener('message', event => {\n        onSimulationTicked(event.data);\n      });\n      setWorker(sim);\n    }\n  }, [worker, setWorker, onSimulationTicked, simulationProps]);\n\n  return [worker, setWorker];\n}\n","import React from 'react';\nimport { useCanvas } from '../../hooks';\n\nexport default function Canvas2d({\n  onClick,\n  className,\n  drawFunction = () => {},\n  height = 500,\n  width = 500,\n  canvasPixelRatio = 2,\n  onMouseDown,\n  onMouseMove,\n  onMouseUp,\n  style = {},\n  onTouchEnd,\n  onTouchMove,\n  onTouchStart,\n}) {\n  const canvasRef = useCanvas(drawFunction, canvasPixelRatio);\n  const sizeInPixels = { width: `${width}px`, height: `${height}px` };\n  return <canvas\n    className={className}\n    width={width * canvasPixelRatio}\n    height={height * canvasPixelRatio}\n    style={{ ...sizeInPixels, ...style }}\n    ref={canvasRef}\n    onTouchStart={onTouchStart}\n    onTouchMove={onTouchMove}\n    onTouchEnd={onTouchEnd}\n    onMouseMove={onMouseMove}\n    onMouseDown={onMouseDown}\n    onMouseUp={onMouseUp}\n    onClick={onClick}\n  />;\n}\n\n","import { useRef, useEffect } from \"react\";\n\nexport default function useCanvas(draw, ratio = 1) {\n  const canvasRef = useRef(null);\n\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    const ctx = canvas.getContext('2d');\n\n    function renderFrame() {\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n      ctx.save();\n      ctx.scale(ratio, ratio);\n      draw(ctx);\n      ctx.restore();\n    }\n    const animationFrameId = requestAnimationFrame(renderFrame);\n\n    return () => cancelAnimationFrame(animationFrameId);\n  }, [draw, ratio]);\n\n  return canvasRef;\n}\n\n","import React, { useLayoutEffect, useMemo, useRef } from 'react';\nimport { area, scaleLinear, select, stack } from 'd3';\n\nimport { COLOR_BY_DISEASE, DISEASE } from '../../hooks/useSimulation';\nimport './VirusStackedArea.scss';\n\nconst { INFECTED, SUSCEPTIBLE, RECOVERED } = DISEASE;\n\nexport default function VirusStackedArea({\n  handleMouseMove,\n  handleTouchMove,\n  handleMouseLeave,\n  height: containerHeight,\n  margin = { top: 5, left: 5, bottom: 5, right: 5 },\n  transitionDuration = 1000,\n  virusHistory: fullHistory,\n  nNodes,\n  width: containerWidth,\n}) {\n  const [virusHistory] = useMemo(() => {\n    const interval = (String(fullHistory.length).length) * 2 || 1;\n    const subsampled = [];\n    for(let i = 0; i < fullHistory.length; i = i + interval) {\n      subsampled.push(fullHistory[i]);\n    }\n    return [subsampled];\n  }, [fullHistory]);\n  const [height, width] = useMemo(() => {\n    return [\n      containerHeight - margin.top - margin.bottom,\n      containerWidth - margin.left - margin.right,\n    ];\n  }, [containerWidth, containerHeight, margin]);\n\n  const xScale = useMemo(() => {\n    if (virusHistory.length) {\n      const maxTick = Math.max(\n        virusHistory[virusHistory.length - 1].tick,\n        2000,\n      );\n      return scaleLinear().domain([0, maxTick]).range([0, width])\n    }\n    return scaleLinear();\n  }, [virusHistory, width]);\n\n  const yScale = useMemo(() => {\n    return scaleLinear()\n    .domain([0, nNodes])\n    .range([height, 0]);\n  }, [nNodes, height]);\n\n  const series = useMemo(() => {\n    return stack().keys([INFECTED, SUSCEPTIBLE, RECOVERED])(virusHistory);\n  }, [virusHistory]);\n\n  const areasRef = useRef();\n\n  /* -------- Render Lines/Labels/Areas -------- */\n  useLayoutEffect(() => {\n    // console.log(xScale.domain(), xScale.range());\n    const areaGen = area()\n      .x(d => xScale(d.data.tick))\n      .y0(d => yScale(d[0]))\n      .y1(d => yScale(d[1]))\n\n    select(areasRef.current)\n      .selectAll('path')\n      .data(series)\n      .join('path')\n      .attr('d', areaGen)\n      .attr(\"fill\", ({ key }) => COLOR_BY_DISEASE[key])\n    }, [series, areasRef, transitionDuration, xScale, yScale]);\n\n  return (\n    <div className=\"stacked-area-chart-wrapper\" >\n      <svg\n        onMouseMove={handleMouseMove}\n        onTouchMove={handleTouchMove}\n        onMouseLeave={handleMouseLeave}\n        onTouchEnd={handleMouseLeave}\n        height=\"100%\"\n        width=\"100%\"\n        viewBox={`0 0 ${containerWidth} ${containerHeight}`}\n        preserveAspectRatio=\"none\"\n        overflow=\"hidden\">\n        <g transform={`translate(${margin.left}, ${margin.top})`} ref={areasRef} />\n      </svg>\n    </div>\n  );\n}\n","import React, { useMemo } from 'react';\nimport Canvas2d from '../Canvas/Canvas2d';\nimport { drawNodes } from '../../hooks/useSimulation';\n\nimport './MultiSimlulationContainer.scss';\nimport { VirusStackedArea } from '../VirusStackedArea';\n\nconst drawFunction = ({\n  positionNodes = [],\n  virusNodes = []\n}) => ((ctx) => drawNodes(ctx, positionNodes, virusNodes));\n\nexport default function MultiSimulationContainer({\n  simulationState: {\n    isRunning,\n    isStasisReached,\n    positionNodes = [],\n    virusSimulations,\n  } = {},\n  handleClick,\n  height,\n  width,\n}) {\n  const interactionMessage = useMemo(() => {\n    if (isStasisReached) {\n      return '(touch to start a new simulation)';\n    } else if (isRunning === true) {\n      return '(touch to pause)';\n    } else if (isRunning === false) {\n      return '(touch to resume)';\n    }\n    return '';\n  }, [isRunning, isStasisReached]);\n\n  return <div className=\"multi-simulation-container\" >\n    {\n      virusSimulations\n      && virusSimulations.map(({ title, percentMasked, virusHistory, virusNodes }, index) => (\n        <div className=\"simulation-group-container\" key={`sim-canvas-${index}`} >\n          <div\n            className=\"simulation-canvas-labels\"\n            onClick={handleClick}\n          >\n            <span className=\"simulation-title\">{title || `${percentMasked}% mask use`}</span>\n            <span className=\"interaction-label\">{interactionMessage}</span>\n          </div>\n          <Canvas2d\n            className=\"simulation-canvas\"\n            drawFunction={drawFunction({ positionNodes, virusNodes })}\n            onClick={handleClick}\n            ontouchend={handleClick}\n            height={height}\n            width={width}\n          />\n          <VirusStackedArea\n            nNodes={virusNodes.length}\n            virusHistory={virusHistory}\n            height={60}\n            width={width}\n          />\n        </div>\n      ))}\n  </div>;\n}\n","import React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { useSimulation, MASK, MASK_ATTACK_REDUCTION } from '../../hooks';\nimport { MultiSimulationContainer } from '../MultiSimulationContainer';\n\nconst defaultProps = {\n  attackSuccessProbability: 0.05,\n  historyInterval: 3,\n  nNodes: 40,\n  radius: 7,\n  ticksToRecover: 1000,\n  velocity: 3.5,\n  virusSimulations: [\n    {\n      title: 'No mask use',\n      maskedType: MASK.NON_MEDICAL,\n      nInfected: 3,\n      percentMasked: 0,\n      maskTransmissionReduction: MASK_ATTACK_REDUCTION,\n    },\n    {\n      title: '95% mask use',\n      maskedType: MASK.NON_MEDICAL,\n      nInfected: 3,\n      percentMasked: 95,\n      maskTransmissionReduction: MASK_ATTACK_REDUCTION,\n    },\n  ],\n};\n\nexport default function Simulation({\n  simulationProps = defaultProps,\n  height: containerHeight = 400,\n  margin = { top: 20, left: 20, bottom: 20, right: 20 },\n  width: containerWidth = 400,\n}) {\n  const [simulationState, setSimulationState] = useState({});\n\n  const [height, width] = useMemo(() => {\n    const isMobile = containerWidth > 600;\n    const wrapDenom = isMobile ? 2 : 1;\n    // make space square\n    const min = Math.min(\n      containerHeight - margin.top - margin.bottom,\n      (containerWidth - (margin.left - margin.right) * wrapDenom) / wrapDenom\n    );\n    return [min, min];\n  }, [containerHeight, containerWidth, margin]);\n\n  const [worker] = useSimulation({ height, width, ...simulationProps }, setSimulationState);\n\n  useEffect(() => {\n    if (worker) {\n      worker.postMessage({ action: 'RESIZE', height, width });\n    }\n  }, [height, width, worker]);\n\n  const handleClick = useCallback(() => {\n    if (simulationState.isStasisReached) {\n      worker.postMessage({ action: 'NEW_SIMULATION', height, width, ...simulationProps });\n    } else if (simulationState.isRunning === true) {\n      worker.postMessage({ action: 'PAUSE' });\n    } else if (simulationState.isRunning === false) {\n      worker.postMessage({ action: 'RESUME' });\n    }\n  }, [worker, height, width, simulationProps, simulationState]);\n\n  return <MultiSimulationContainer\n    simulationState={simulationState}\n    handleClick={handleClick}\n    height={height}\n    width={width}\n  />;\n};\n","import React from 'react';\nimport { useMeasure } from 'react-use';\nimport MaskSimulation from './MaskSimulation';\nimport './MaskSimulationContainer.scss';\n\nexport default function MaskSimulationContainer() {\n  const [containerRef, { height, width }] = useMeasure();\n  return (\n    <div className=\"mask-simulation-container\" ref={containerRef} >\n      <MaskSimulation height={height} width={width} />\n    </div>\n  );\n}\n\n","import React from 'react';\nimport './App.css';\nimport { MaskSimulation } from './components';\n\nfunction App() {\n  return (\n    <div className=\"App\">\n      <MaskSimulation />\n    </div>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}